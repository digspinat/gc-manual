{{ partial "header.html" . }}
<div class="header">
  <h1>{{ .Title }}</h1>
</div>
<div class="my_content">
  <div class="container">
  <div class="row">
    <div class="col-md-3 filter">
      {{ partial "filter.html" . }}
    </div>
      <div class="col-md-9">
          <div class="row" id="productdata">
            {{ range .Data.Pages }}
              {{ .Render "summary"}}
            {{ end }}
          </div>
        </div>
      </div>
  </div>
  <form class="">
    <input type="hidden" id="display_brand" value="{{ .Title }}">
  </form>
</div>
<script type="text/javascript">
    var client = algoliasearch("YZO8M6AZ6J", "847f24047332edf2bb6a0c1f0181b83e");
    var index = client.initIndex('new_gcm_car');

    var searchBrand = $("#display_brand").val();
    var MainSearch = [];
    var BrandSearch = [];
    BrandSearch.push("Make:"+searchBrand);
    MainSearch.push(BrandSearch);

    var searchBrand = $("#display_brand").val();
    var MainSearch = [];
    var BrandSearch = [], BrandArray = [];
    BrandSearch.push("Make:"+searchBrand);
    MainSearch.push(BrandSearch);

    index.search({
      query: searchBrand,
      hitsPerPage: 100,
      facetFilters: MainSearch,
      facets: ["Make","Engine","Manual_file_type","Platform","Serie","Sub_serie","Year"],
    }).then(res => {
      // console.log(res);
      var YearText = "";
      var SerieText = "";
      var EngineText = "";
      var PlatformText = "";
      var Sub_serieText = "";
      var Manual_file_typeText = "";
      var manualYear = res.facets['Year'];
      var manualSerie = res.facets['Serie'];
      var manualEngine = res.facets['Engine'];
      var manualPlatform = res.facets['Platform'];
      var manualSub_serie = res.facets['Sub_serie'];
      var manualManual_file_type = res.facets['Manual_file_type'];

      $.each( manualSerie, function( key, value ) {
        SerieText += "<input type='checkbox' class='mySearch series' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
      });
      $("#my_series").html(SerieText);

      $.each( manualSub_serie, function( key, value ) {
        Sub_serieText += "<input type='checkbox' class='mySearch subseries' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
      });
      $("#my_suseries").html(Sub_serieText);

      $.each( manualPlatform, function( key, value ){
        PlatformText += "<input type='checkbox' class='mySearch platform' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
      });
      $("#my_platform").html(PlatformText);

      $.each( manualEngine, function( key, value ){
        EngineText += "<input type='checkbox' class='mySearch engine' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
      });
      $("#my_engine").html(EngineText);

      $.each( manualYear, function( key, value ){
        YearText += "<input type='checkbox' class='mySearch year' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
      });
      $("#my_year").html(YearText);

      $.each( manualManual_file_type, function( key, value ){
        Manual_file_typeText += "<input type='checkbox' class='mySearch filetype' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
      });
      $("#my_manual").html(Manual_file_typeText);

      var prodcuct = "";
      $.each(res.hits, function( i, val ){
        prodcuct += "<div class='col-md-4'>"+
            "<div class='ibox'>"+
                "<div class='ibox-content product-box'>"+
                    "<div class='product-imitation'>"+
                        "<img src='"+val['Productpage_image']+"' alt='' height='200px;' width='200px;'>"+
                    "</div>"+
                    "<div class='product-desc'>"+
                        "<span class='product-price'>"+
                            "Price: "+val['Currency']+" "+val['Price']+
                        "</span>"+
                        "<small class='text-muted'></small>"+
                        "<a href='/products/"+val['Car_ID']+"' class='product-name'>"+val['Title']+"</a>"+
                        "<div class='m-t text-righ'>"+
                            "<a href='/products/"+val['Car_ID']+"' class='btn btn-xs btn-outline btn-primary'>Info <i class='fa fa-long-arrow-right'></i></a>"+
                        "</div>"+
                    "</div>"+
                "</div>"+
            "</div>"+
        "</div>";
      });
      $("#productdata").html(prodcuct);

    });

  $(document).on('click','.mySearch',function(){
    if(this.checked){
      var MainSearch = []
      var SeriesSearch = [], SeriesArray = [];
      var SubseriesSearch = [], SubseriesArray = [];
      var PlatformSearch = [], PlatformArray = [];
      var EngineSearch = [], EngineArray = [];
      var YearSerach = [], YearArray = [];
      var ManualType = [], ManualArray = [];
      $('.series').each(function(){
        if (this.checked){
          SeriesSearch.push("Serie:"+$(this).val())
          SeriesArray.push($(this).val())
        }
      });
      $('.subseries').each(function(){
        if (this.checked){
          SubseriesSearch.push("Sub_serie:"+$(this).val())
          SubseriesArray.push($(this).val())
        }
      });
      $('.platform').each(function(){
        if (this.checked){
          PlatformSearch.push("Platform:"+$(this).val())
          PlatformArray.push($(this).val())
        }
      });
      $('.engine').each(function(){
        if (this.checked){
          EngineSearch.push("Engine:"+$(this).val())
          EngineArray.push($(this).val())
        }
      });
      $('.year').each(function(){
        if (this.checked){
          YearSerach.push("Year:"+$(this).val())
          YearArray.push($(this).val())
        }
      });
      $('.filetype').each(function(){
        if (this.checked){
          ManualType.push("Manual_file_type:"+$(this).val())
          ManualArray.push($(this).val())
        }
      });
      MainSearch.push(SeriesSearch);
      // console.log(SeriesSearch);
      MainSearch.push(SubseriesSearch);
      // console.log(SubseriesSearch);
      MainSearch.push(PlatformSearch);
      // console.log(PlatformSearch);
      MainSearch.push(EngineSearch);
      // console.log(EngineSearch);
      MainSearch.push(YearSerach);
      // console.log(YearSerach);
      MainSearch.push(ManualType);
      // console.log(ManualType);
      console.log(MainSearch);
      index.search({
        query: searchBrand,
        facetFilters: MainSearch,
        facets: ["Make","Engine","Manual_file_type","Platform","Serie","Sub_serie","Year"]
      }).then(res => {
        console.log(res);
        var YearText = "";
        var SerieText = "";
        var EngineText = "";
        var PlatformText = "";
        var Sub_serieText = "";
        var Manual_file_typeText = "";
        var manualYear = res.facets['Year'];
        var manualSerie = res.facets['Serie'];
        var manualEngine = res.facets['Engine'];
        var manualPlatform = res.facets['Platform'];
        var manualSub_serie = res.facets['Sub_serie'];
        var manualManual_file_type = res.facets['Manual_file_type'];

        $.each( manualSerie, function( key, value ) {
          if($.inArray(key,SeriesArray) != -1){
            SerieText += "<input type='checkbox' checked class='mySearch series' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            SerieText += "<input type='checkbox' class='mySearch series' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_series").html(SerieText);

        $.each( manualSub_serie, function( key, value ) {
          if($.inArray(key,SubseriesArray) != -1){
            Sub_serieText += "<input type='checkbox' checked class='mySearch subseries' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            Sub_serieText += "<input type='checkbox' class='mySearch subseries' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_suseries").html(Sub_serieText);

        $.each( manualPlatform, function( key, value ) {
          if($.inArray(key,PlatformArray) != -1){
            PlatformText += "<input type='checkbox' checked class='mySearch platform' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            PlatformText += "<input type='checkbox' class='mySearch platform' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_platform").html(PlatformText);

        $.each( manualEngine, function( key, value ) {
          if($.inArray(key,EngineArray) != -1){
            EngineText += "<input type='checkbox' checked class='mySearch engine' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            EngineText += "<input type='checkbox' class='mySearch engine' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_engine").html(EngineText);

        $.each( manualYear, function( key, value ) {
          if($.inArray(key,YearArray) != -1){
            YearText += "<input type='checkbox' checked class='mySearch year' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            YearText += "<input type='checkbox' class='mySearch year' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_year").html(YearText);

        $.each( manualManual_file_type, function( key, value ) {
          if($.inArray(key,ManualArray) != -1){
            Manual_file_typeText += "<input type='checkbox' checked class='mySearch filetype' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            Manual_file_typeText += "<input type='checkbox' class='mySearch filetype' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_manual").html(Manual_file_typeText);

        var prodcuct = ""
        $.each(res.hits, function( i, val ){
          prodcuct += "<div class='col-md-4'>"+
              "<div class='ibox'>"+
                  "<div class='ibox-content product-box'>"+
                      "<div class='product-imitation'>"+
                          "<img src='"+val['Productpage_image']+"' alt='' height='200px;' width='200px;'>"+
                      "</div>"+
                      "<div class='product-desc'>"+
                          "<span class='product-price'>"+
                              "Price: "+val['Currency']+" "+val['Price']+
                          "</span>"+
                          "<small class='text-muted'></small>"+
                          "<a href='/products/"+val['Car_ID']+"' class='product-name'>"+val['Title']+"</a>"+
                          "<div class='m-t text-righ'>"+
                              "<a href='/products/"+val['Car_ID']+"' class='btn btn-xs btn-outline btn-primary'>Info <i class='fa fa-long-arrow-right'></i></a>"+
                          "</div>"+
                      "</div>"+
                  "</div>"+
              "</div>"+
          "</div>";
        });
        $("#productdata").html(prodcuct);
      });
    }else{
      $(this).removeAttr( "checked" )
      var MainSearch = [];
      var SeriesSearch = [], SeriesArray = [];
      var SubseriesSearch = [], SubseriesArray = [];
      var PlatformSearch = [], PlatformArray = [];
      var EngineSearch = [], EngineArray = [];
      var YearSerach = [], YearArray = [];
      var ManualType = [], ManualArray = [];
      $('.series').each(function(){
        if (this.checked){
          SeriesSearch.push("Serie:"+$(this).val());
          SeriesArray.push($(this).val());
        }
      });
      $('.subseries').each(function(){
        if (this.checked){
          SubseriesSearch.push("Sub_serie:"+$(this).val());
          SubseriesArray.push($(this).val());
        }
      });
      $('.platform').each(function(){
        if (this.checked){
          PlatformSearch.push("Platform:"+$(this).val());
          PlatformArray.push($(this).val());
        }
      });
      $('.engine').each(function(){
        if (this.checked){
          EngineSearch.push("Engine:"+$(this).val());
          EngineArray.push($(this).val());
        }
      });
      $('.year').each(function(){
        if (this.checked){
          YearSerach.push("Year:"+$(this).val());
          YearArray.push($(this).val());
        }
      });
      $('.filetype').each(function(){
        if (this.checked){
          ManualType.push("Manual_file_type:"+$(this).val());
          ManualArray.push($(this).val());
        }
      });
      MainSearch.push(SeriesSearch);
      // console.log(SeriesSearch);
      MainSearch.push(SubseriesSearch);
      // console.log(SubseriesSearch);
      MainSearch.push(PlatformSearch);
      // console.log(PlatformSearch);
      MainSearch.push(EngineSearch);
      // console.log(EngineSearch);
      MainSearch.push(YearSerach);
      // console.log(YearSerach);
      MainSearch.push(ManualType);
      // console.log(ManualType);
      console.log(MainSearch);
      index.search({
        query: searchBrand,
        facetFilters: MainSearch,
        facets: ["Make","Engine","Manual_file_type","Platform","Serie","Sub_serie","Year"]
      }).then(res => {
        console.log(res);
        var YearText = "";
        var SerieText = "";
        var EngineText = "";
        var PlatformText = "";
        var Sub_serieText = "";
        var Manual_file_typeText = "";
        var manualYear = res.facets['Year'];
        var manualSerie = res.facets['Serie'];
        var manualEngine = res.facets['Engine'];
        var manualPlatform = res.facets['Platform'];
        var manualSub_serie = res.facets['Sub_serie'];
        var manualManual_file_type = res.facets['Manual_file_type'];

        $.each( manualSerie, function( key, value ) {
          if($.inArray(key,SeriesArray) != -1){
            SerieText += "<input type='checkbox' checked class='mySearch series' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            SerieText += "<input type='checkbox' class='mySearch series' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_series").html(SerieText);

        $.each( manualSub_serie, function( key, value ) {
          if($.inArray(key,SubseriesArray) != -1){
            Sub_serieText += "<input type='checkbox' checked class='mySearch subseries' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            Sub_serieText += "<input type='checkbox' class='mySearch subseries' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_suseries").html(Sub_serieText);

        $.each( manualPlatform, function( key, value ) {
          if($.inArray(key,PlatformArray) != -1){
            PlatformText += "<input type='checkbox' checked class='mySearch platform' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            PlatformText += "<input type='checkbox' class='mySearch platform' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_platform").html(PlatformText);

        $.each( manualEngine, function( key, value ) {
          if($.inArray(key,EngineArray) != -1){
            EngineText += "<input type='checkbox' checked class='mySearch engine' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            EngineText += "<input type='checkbox' class='mySearch engine' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_engine").html(EngineText);

        $.each( manualYear, function( key, value ) {
          if($.inArray(key,YearArray) != -1){
            YearText += "<input type='checkbox' checked class='mySearch year' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            YearText += "<input type='checkbox' class='mySearch year' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_year").html(YearText);

        $.each( manualManual_file_type, function( key, value ) {
          if($.inArray(key,ManualArray) != -1){
            Manual_file_typeText += "<input type='checkbox' checked class='mySearch filetype' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }else{
            Manual_file_typeText += "<input type='checkbox' class='mySearch filetype' value='"+key+"'>&nbsp;<span class='gcm-header'>"+key+" ("+value+")</span><br>";
          }
        });
        $("#my_manual").html(Manual_file_typeText);

        var prodcuct = ""
        $.each(res.hits, function( i, val ){
          prodcuct += "<div class='col-md-4'>"+
              "<div class='ibox'>"+
                  "<div class='ibox-content product-box'>"+
                      "<div class='product-imitation'>"+
                          "<img src='"+val['Productpage_image']+"' alt='' height='200px;' width='200px;'>"+
                      "</div>"+
                      "<div class='product-desc'>"+
                          "<span class='product-price'>"+
                              "Price: "+val['Currency']+" "+val['Price']+
                          "</span>"+
                          "<small class='text-muted'></small>"+
                          "<a href='/products/"+val['Car_ID']+"' class='product-name'>"+val['Title']+"</a>"+
                          "<div class='m-t text-righ'>"+
                              "<a href='/products/"+val['Car_ID']+"' class='btn btn-xs btn-outline btn-primary'>Info <i class='fa fa-long-arrow-right'></i></a>"+
                          "</div>"+
                      "</div>"+
                  "</div>"+
              "</div>"+
          "</div>";
        });
        $("#productdata").html(prodcuct);
      });
    }
  });
</script>
{{ partial "footer.html" . }}
